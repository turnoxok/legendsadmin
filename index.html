<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tilcara Legends | Estado de Pagos</title>
<link rel="icon" href="https://i.ibb.co/nN8LPTjD/logo-verde.png">
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<style>
body { font-family:"Montserrat",sans-serif; background:#F5F6F2; color:#084D1F; padding:10px; }
h2 { text-align:center; margin-bottom:15px; }
select { padding:8px; border-radius:6px; border:1px solid #084D1F; margin-bottom:15px; }
table { width:100%; border-collapse:collapse; margin:0 auto; }
th,td { border:1px solid #084D1F; padding:8px; text-align:center; }
th { background:#084D1F; color:#F5F6F2; }
tr.pagado { background:#c8e6c9; }
tr.saldo { background:#ffcccb; }
@media(max-width:600px){ table, th, td{ font-size:14px; } select{width:100%;} }
</style>
</head>
<body>

<h2>Estado de Pagos de Jugadores</h2>

<select id="clubSelect" onchange="loadPlayersByClub()">
  <option value="">--Seleccione Club--</option>
  <option value="Tilcara Legends (Paraná)">Tilcara Legends (Paraná)</option>
  <option value="Club 2">Club 2</option>
  <option value="Club 3">Club 3</option>
  <option value="Club 4">Club 4</option>
  <option value="Club 5">Club 5</option>
  <option value="Club 6">Club 6</option>
</select>

<table>
<thead>
<tr>
<th>#</th>
<th>Nombre</th>
<th>Estado</th>
<th>Total</th>
<th>Pago</th>
<th>Saldo</th>
</tr>
</thead>
<tbody id="playersTable"></tbody>
</table>

<script>
const API_URL = '/.netlify/functions/gs-proxy';

async function loadPlayersByClub(){
  const club = document.getElementById("clubSelect").value;
  if(!club) return;
  try{
    const res = await fetch(API_URL,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:"getPlayersPublic", club})
    });
    const data = await res.json();
    if(data.ok){
      const tbody = document.getElementById("playersTable");
      tbody.innerHTML="";
      data.players.forEach((p,index)=>{
        const total = Number(p.Total)||0;
        const pago = Number(p.Pago)||0;
        const saldo = Number(p.Saldo)||(total-pago);
        const estado = saldo===0 ? "Pagado" : "Saldo pendiente";
        const tr = document.createElement("tr");
        tr.className = saldo===0 ? "pagado" : "saldo";
        tr.innerHTML = `<td>${index+1}</td>
                        <td>${p.Nombre} ${p.Apellido.charAt(0)}.</td>
                        <td>${estado}</td>
                        <td>${total}</td>
                        <td>${pago}</td>
                        <td>${saldo}</td>`;
        tbody.appendChild(tr);
      });
    } else { console.error("Error al cargar jugadores:",data.error); }
  } catch(err){ console.error(err); }
}
</script>
</body>
</html>
